<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Booknest - Administrador</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <header>
    <div class="header-container">

      <button onclick="cerrarSesion()" class="btn-cerrar">Cerrar Sesión</button>
    </div>
  </header>

  <div class="container">
    <div class="menu-opciones">
      <button onclick="mostrarSeccion('libros')">Registrar Libro</button>
      <button onclick="mostrarSeccion('ventas')">Registro de Ventas</button>
      <button onclick="mostrarSeccion('prestamos')">Registro de Préstamos</button>
    </div>

    <!-- SECCION LIBROS -->
    <div id="libros" class="seccion">
      <h2>Registrar Libro</h2>
      <input type="text" id="titulo" placeholder="Título">
      <input type="text" id="autor" placeholder="Autor">
      <select id="estado">
        <option value="disponible">Disponible</option>
        <option value="venta">En venta</option>
        <option value="prestamo">En préstamo</option>
      </select>
      <input type="number" id="stock" placeholder="Stock" min="0">
      <input type="number" id="precio" placeholder="Precio (en $)" min="0">
      <button onclick="agregarLibro()">Agregar Libro</button>

      <table id="tablaLibrosAdmin">
        <thead>
          <tr>
            <th>Título</th>
            <th>Autor</th>
            <th>Estado</th>
            <th>Stock</th>
            <th>Precio</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- SECCIÓN VENTAS -->
    <div id="ventas" class="seccion">
      <h2>Registro de Ventas</h2>
      <table id="tablaVentas">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Cliente</th>
            <th>Libro</th>
            <th>Cantidad</th>
            <th>Precio Total</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- SECCIÓN PRÉSTAMOS -->
    <div id="prestamos" class="seccion">
      <h2>Registro de Préstamos</h2>
      <table id="tablaPrestamos">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Cliente</th>
            <th>Libro</th>
            <th>Cantidad</th>
            <th>Duración</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    let libros = JSON.parse(localStorage.getItem("libros")) || [];
    let transacciones = JSON.parse(localStorage.getItem("transacciones")) || [];

    document.addEventListener("DOMContentLoaded", () => {
      mostrarLibrosAdmin();
      mostrarTransacciones();
      mostrarSeccion('libros'); // Mostrar registro de libros al inicio
    });

    function cerrarSesion() {
      localStorage.removeItem("rol");
      window.location.href = "login.html";
    }

    function mostrarSeccion(id) {
      document.querySelectorAll(".seccion").forEach(s => s.style.display = "none");
      document.getElementById(id).style.display = "block";
    }

    function agregarLibro() {
      const titulo = document.getElementById("titulo").value.trim();
      const autor = document.getElementById("autor").value.trim();
      const estado = document.getElementById("estado").value;
      const stock = parseInt(document.getElementById("stock").value.trim());
      const precio = parseFloat(document.getElementById("precio").value.trim());

      if (!titulo || !autor || isNaN(stock) || stock < 0 || isNaN(precio) || precio < 0) {
        mostrarMensaje('error', 'Complete todos los campos correctamente');
        return;
      }

      libros.push({ titulo, autor, estado, stock, precio });
      guardarLibros();
      mostrarLibrosAdmin();
      mostrarMensaje('success', 'Libro agregado exitosamente');

      document.getElementById("titulo").value = "";
      document.getElementById("autor").value = "";
      document.getElementById("stock").value = "";
      document.getElementById("precio").value = "";
    }

    function eliminarLibro(i) {
      if (!confirm('¿Está seguro de eliminar este libro?')) return;
      libros.splice(i, 1);
      guardarLibros();
      mostrarLibrosAdmin();
      mostrarMensaje('info', 'Libro eliminado exitosamente');
    }

    function mostrarLibrosAdmin() {
      const tbody = document.querySelector("#tablaLibrosAdmin tbody");
      tbody.innerHTML = "";
      libros.forEach((libro, i) => {
        tbody.innerHTML += `
          <tr>
            <td>${libro.titulo}</td>
            <td>${libro.autor}</td>
            <td>${libro.estado}</td>
            <td>${libro.stock}</td>
            <td>$${libro.precio.toFixed(2)}</td>
            <td><button class="btn-eliminar" onclick="eliminarLibro(${i})">Eliminar</button></td>
          </tr>`;
      });
    }

    function mostrarTransacciones() {
      const ventasBody = document.querySelector("#tablaVentas tbody");
      const prestamosBody = document.querySelector("#tablaPrestamos tbody");

      ventasBody.innerHTML = "";
      prestamosBody.innerHTML = "";

      transacciones.forEach((t, index) => {
        if (t.tipo === "venta") {
          ventasBody.innerHTML += `
            <tr>
              <td>${t.fecha}</td>
              <td>${t.usuario || 'Cliente desconocido'}</td>
              <td>${t.libro}</td>
              <td>${t.cantidad || 1}</td>
              <td>$${t.precioTotal || 0}</td>
              <td><button class="btn-eliminar" onclick="eliminarTransaccion(${index})">Eliminar</button></td>
            </tr>`;
        } else if (t.tipo === "prestamo") {
          prestamosBody.innerHTML += `
            <tr>
              <td>${t.fecha}</td>
              <td>${t.usuario || 'Cliente desconocido'}</td>
              <td>${t.libro}</td>
              <td>${t.cantidad || 1}</td>
              <td>${t.duracion || '-'}</td>
              <td><button class="btn-eliminar" onclick="eliminarTransaccion(${index})">Eliminar</button></td>
            </tr>`;
        }
      });
    }

    function eliminarTransaccion(index) {
      if (!confirm("¿Deseas eliminar este registro?")) return;
      transacciones.splice(index, 1);
      localStorage.setItem("transacciones", JSON.stringify(transacciones));
      mostrarTransacciones();
      mostrarMensaje("info", "Registro eliminado");
    }

    function guardarLibros() {
      localStorage.setItem("libros", JSON.stringify(libros));
    }

    function mostrarMensaje(tipo, mensaje) {
      const toast = document.createElement('div');
      toast.className = `toast ${tipo}`;
      toast.textContent = mensaje;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }
  </script>
</body>
</html>