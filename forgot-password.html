
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Recuperar contrase√±a - Booknest</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body class="contrase√±a-body">

  <div class="forgot-box">
    <h2>Recuperar contrase√±a</h2>

    <!-- ‚úÖ PASO 1: ingresar el correo -->
    <div id="step-email">
      <p>Ingresa tu correo para recibir un c√≥digo temporal (simulado).</p>
      <form onsubmit="return solicitarCodigo()">
        <input type="email" id="email-reset" placeholder="correo@ejemplo.com" required>
        <button type="submit">Enviar c√≥digo</button>
      </form>

      <p><a href="login.html">Volver al inicio</a></p>
    </div>

    <!-- ‚úÖ PASO 2 (oculto al inicio): escribir c√≥digo + nueva contrase√±a -->
    <div id="step-verify" style="display:none;">
      <p>Introduce el c√≥digo que recibiste y la nueva contrase√±a.</p>

      <form onsubmit="return verificarYCambiar()">
        <input type="text" id="codigo-input" placeholder="C√≥digo de 6 d√≠gitos" required>

        <!-- üü¢ Campo de nueva contrase√±a con ojo -->
        <label for="new-password">Nueva contrase√±a:</label>
        <div class="password-container">
          <input type="password" id="new-password" placeholder="Nueva contrase√±a" required oninput="verificarFuerzaPassword()">
          <span class="toggle-password" onclick="togglePassword('new-password')">
            <!-- üëÅÔ∏è SVG ojo abierto -->
            <svg class="icon-eye" width="22" height="22" viewBox="0 0 24 24" fill="#333">
              <path d="M12 4.5C7 4.5 2.73 8.11 1 12c1.73 3.89 6 7.5 11 7.5s9.27-3.61 11-7.5c-1.73-3.89-6-7.5-11-7.5zm0 12a4.5 4.5 0 1 1 0-9 4.5 4.5 0 0 1 0 9z"/>
            </svg>
            <!-- üëÅÔ∏è‚Äçüó®Ô∏è SVG ojo tachado -->
            <svg class="icon-eye-slash" width="22" height="22" viewBox="0 0 24 24" fill="#333" style="display:none">
              <path d="M12 5C7 5 2.73 8.11 1 12a11.94 11.94 0 0 0 2.12 3.06L2 16.18 3.41 17.6l18.02-18.02L22 1.18 20.59 2.6l-2.12 2.12C16.9 3.84 14.53 3 12 3 7 3 2.73 6.11 1 10c1.73 3.89 6 7 11 7 2.53 0 4.9-.84 6.47-2.27l2.12 2.12L22 15.82l-2.12-2.12A11.94 11.94 0 0 0 23 10c-1.73-3.89-6-7-11-7z"/>
            </svg>
          </span>
        </div>

          <!-- üü¢ Campo de nueva contrase√±a con ojo -->
        <label for="confirm-password">Confirmar contrase√±a:</label>
        <div class="password-container">
          <input type="password" id="confirm-password" placeholder="Contrase√±a confirmada" required oninput="verificarFuerzaPassword()">
          <span class="toggle-password" onclick="togglePassword('confirm-password')">
            <!-- üëÅÔ∏è SVG ojo abierto -->
            <svg class="icon-eye" width="22" height="22" viewBox="0 0 24 24" fill="#333">
              <path d="M12 4.5C7 4.5 2.73 8.11 1 12c1.73 3.89 6 7.5 11 7.5s9.27-3.61 11-7.5c-1.73-3.89-6-7.5-11-7.5zm0 12a4.5 4.5 0 1 1 0-9 4.5 4.5 0 0 1 0 9z"/>
            </svg>
            <!-- üëÅÔ∏è‚Äçüó®Ô∏è SVG ojo tachado -->
            <svg class="icon-eye-slash" width="22" height="22" viewBox="0 0 24 24" fill="#333" style="display:none">
              <path d="M12 5C7 5 2.73 8.11 1 12a11.94 11.94 0 0 0 2.12 3.06L2 16.18 3.41 17.6l18.02-18.02L22 1.18 20.59 2.6l-2.12 2.12C16.9 3.84 14.53 3 12 3 7 3 2.73 6.11 1 10c1.73 3.89 6 7 11 7 2.53 0 4.9-.84 6.47-2.27l2.12 2.12L22 15.82l-2.12-2.12A11.94 11.94 0 0 0 23 10c-1.73-3.89-6-7-11-7z"/>
            </svg>
          </span>
        </div>

        <!-- Barra de fuerza -->
        <div style="margin: -10px 0 15px 0;">
          <div id="barraFuerza" style="height: 8px; width: 100%; background: #e0e0e0; border-radius: 4px; overflow: hidden;">
            <div id="nivelFuerza" style="height: 100%; width: 0%; transition: all 0.3s ease; border-radius: 4px;"></div>
          </div>
          <small id="textoFuerza" style="color: #666; font-size: 0.85rem; display: block; margin-top: 5px;">
            M√≠nimo 8 caracteres, 1 may√∫scula, 1 min√∫scula, 1 n√∫mero y 1 car√°cter especial (@$!%*?&)
          </small>
        </div>

   
        <button type="submit">Cambiar contrase√±a</button>
      </form>

      <p><a href="login.html">Volver al inicio</a></p>
    </div>
  </div>

  <!-- ‚úÖ Script limpio y funcional -->
  <script>
    // Mostrar / ocultar contrase√±a
    function togglePassword(id) {
      const input = document.getElementById(id);
      const eye = input.parentNode.querySelector(".icon-eye");
      const eyeSlash = input.parentNode.querySelector(".icon-eye-slash");

      if (input.type === "password") {
        input.type = "text";
        eye.style.display = "none";
        eyeSlash.style.display = "inline";
      } else {
        input.type = "password";
        eye.style.display = "inline";
        eyeSlash.style.display = "none";
      }
    }

    // Verificar fuerza de contrase√±a
    function verificarFuerzaPassword() {
      const password = document.getElementById("new-password").value;
      const barra = document.getElementById("nivelFuerza");
      const texto = document.getElementById("textoFuerza");
      let fuerza = 0;
      let requisitos = [];

      if (password.length >= 8) fuerza++; else requisitos.push("8 caracteres");
      if (/[A-Z]/.test(password)) fuerza++; else requisitos.push("1 may√∫scula");
      if (/[a-z]/.test(password)) fuerza++; else requisitos.push("1 min√∫scula");
      if (/[0-9]/.test(password)) fuerza++; else requisitos.push("1 n√∫mero");
      if (/[@$!%*?&]/.test(password)) fuerza++; else requisitos.push("1 car√°cter especial");

      if (fuerza === 0 || password.length === 0) {
        barra.style.width = "0%";
        barra.style.backgroundColor = "#e0e0e0";
        texto.style.color = "#666";
        texto.textContent = "M√≠nimo 8 caracteres, 1 may√∫scula, 1 min√∫scula, 1 n√∫mero y 1 car√°cter especial (@$!%*?&)";
      } else if (fuerza <= 2) {
        barra.style.width = "33%";
        barra.style.backgroundColor = "#f44336";
        texto.style.color = "#f44336";
        texto.textContent = "‚ùå D√©bil - Faltan: " + requisitos.join(", ");
      } else if (fuerza <= 4) {
        barra.style.width = "66%";
        barra.style.backgroundColor = "#ff9800";
        texto.style.color = "#ff9800";
        texto.textContent = "‚ö†Ô∏è Media - Faltan: " + requisitos.join(", ");
      } else {
        barra.style.width = "100%";
        barra.style.backgroundColor = "#4caf50";
        texto.style.color = "#4caf50";
        texto.textContent = "‚úÖ Contrase√±a segura";
      }
    }

    // Validar seguridad
    function validarSeguridadPassword(password) {
      if (password.length < 8) return "La contrase√±a debe tener al menos 8 caracteres.";
      if (!/[A-Z]/.test(password)) return "Debe contener al menos una letra may√∫scula.";
      if (!/[a-z]/.test(password)) return "Debe contener al menos una letra min√∫scula.";
      if (!/[0-9]/.test(password)) return "Debe contener al menos un n√∫mero.";
      if (!/[@$!%*?&]/.test(password)) return "Debe contener al menos un car√°cter especial (@$!%*?&).";
      return null;
    }

    // Generar c√≥digo
    function generarCodigo() {
      return Math.floor(100000 + Math.random() * 900000).toString();
    }

    // Paso 1
    function solicitarCodigo() {
      const email = document.getElementById("email-reset").value.trim();
      const usuarios = JSON.parse(localStorage.getItem("usuarios")) || [];
      const usuario = usuarios.find(u => u.correo === email);

      if (!usuario) {
        alert("No existe un usuario con ese correo.");
        return false;
      }

      const codigo = generarCodigo();
      localStorage.setItem(`resetCode_${email}`, codigo);
      alert(`C√≥digo de recuperaci√≥n (simulado): ${codigo}`);

      document.getElementById("step-email").style.display = "none";
      document.getElementById("step-verify").style.display = "block";
      localStorage.setItem("resetEmailTemp", email);
      return false;
    }

    // Paso 2
    function verificarYCambiar() {
      const codigoIngresado = document.getElementById("codigo-input").value.trim();
      const newPassword = document.getElementById("new-password").value;
      const confirmPassword = document.getElementById("confirm-password").value;
      const email = localStorage.getItem("resetEmailTemp");

      if (!email) {
        alert("Ha ocurrido un error. Vuelve a iniciar el proceso.");
        window.location.href = "forgot-password.html";
        return false;
      }

      const codigoGuardado = localStorage.getItem(`resetCode_${email}`);
      if (!codigoGuardado) {
        alert("No hay un c√≥digo v√°lido. Solicita uno nuevo.");
        window.location.href = "forgot-password.html";
        return false;
      }

      if (codigoIngresado !== codigoGuardado) {
        alert("C√≥digo incorrecto. Revisa el c√≥digo o solicita uno nuevo.");
        return false;
      }

      const errorPassword = validarSeguridadPassword(newPassword);
      if (errorPassword) {
        alert(errorPassword);
        return false;
      }

      if (newPassword !== confirmPassword) {
        alert("Las contrase√±as no coinciden.");
        return false;
      }

      const usuarios = JSON.parse(localStorage.getItem("usuarios")) || [];
      const idx = usuarios.findIndex(u => u.correo === email);
      if (idx === -1) {
        alert("Usuario no encontrado.");
        return false;
      }

      usuarios[idx].password = newPassword;
      localStorage.setItem("usuarios", JSON.stringify(usuarios));
      localStorage.removeItem(`resetCode_${email}`);
      localStorage.removeItem("resetEmailTemp");

      alert("Contrase√±a cambiada con √©xito. Ahora puedes iniciar sesi√≥n.");
      window.location.href = "login.html";
      return false;
    }
  </script>

</body>
</html>

  </script>

</body>
</html>
